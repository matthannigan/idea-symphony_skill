# Phase 3 Factory Learning & Revisions

**Date:** February 8, 2026
**Context:** Applying Phase 2 orchestrator learning to Factory Phase 3 section development
**Related:** `docs/phase2-learning-revisions.md` (same root cause, different phase)

---

## Problem Discovered

### Same Architecture Failure as Phase 2

Factory Phase 3 exhibited the identical problem we solved in Symphony Phase 2:

**Original SKILL.md approach:**
```markdown
#### Step 3A: Independent Drafts

**Prompt:** `[skill]/references/prompts/phase3-section-draft.md`

For each outline section:
1. Identify assigned personas (from persona files)
2. For each persona, spawn a subagent that:
   - Reads the persona definition
   - Reads SCOPE.md, OUTLINE.md, relevant Symphony summaries
   - Drafts section recommendations from that persona's perspective
```

**What actually happened:**
- Orchestrator ignored the referenced prompt file
- Generated simplified instructions that didn't tell subagents to READ Symphony files
- Summarized brainstorming insights in the prompt instead of directing subagents to source files
- Result: Subagents generated new ideas instead of evaluating existing brainstorming

### Evidence of Failure

**Example subagent prompt generated by orchestrator:**

```
Your Task:

Draft Section 02 recommendations from the Democratic Innovation Researcher's perspective.

Key Brainstorming Insights:
- "Neutral" design embeds privilege: standard program design reflects privileged assumptions...
- Network-based recruitment is essential: must partner with trusted community organizations...
- Stratified sortition ensures representation: pure randomness yields homogeneous participants...
```

**What's missing:**
1. No instruction to use Read tool for Symphony session files
2. Brainstorming insights summarized in prompt (not directing to source)
3. No mention of BRAINSTORM.md, summary files, or synthesis files
4. No context window warnings about file sizes
5. No emphasis on "evaluate existing ideas" vs. "generate new ideas"

**Root cause:** Same as Phase 2 — orchestrator doesn't automatically read and use referenced prompt files. The instruction "using prompt from [file]" is not executed.

---

## Solution Implemented

### Embed Critical Instructions in SKILL.md

Following the Phase 2 pattern, embed detailed instructions directly where orchestrator can see them:

**Step 3A now includes:**

```markdown
**CRITICAL: Subagents must READ Symphony session files directly. Do NOT summarize
brainstorming insights in the subagent prompt. The Symphony session contains the
source material that subagents must evaluate.**

**Instructions for subagent:**

1. **Read your persona definition:** `personas/[persona-slug].md`
   - Adopt this persona's perspective fully

2. **Read project context files:**
   - `SCOPE.md` — What the plan covers vs. what's background context
   - `OUTLINE.md` — Section structure, decision points, and which Symphony topics map to your section

3. **Read Symphony brainstorming outputs — THIS IS YOUR SOURCE MATERIAL:**
   - Start with: `[symphony-path]/BRAINSTORM.md` — Overview of all brainstorming topics
   - Then read: `[symphony-path]/synthesis/[NN]_[topic]_summary.md` — Read ONLY the summaries
     that OUTLINE.md lists as inputs for your assigned section
   - **Context window warning:** Each summary is 11-17K tokens. Only read summaries relevant to your section.
   - **Optional deeper dive:** If you need more detail on a specific decision point, read ONE
     synthesis file: `[symphony-path]/synthesis/[NN]_[topic]_synthesis.md` (24-34K tokens each)

4. **Your task is to EVALUATE and SYNTHESIZE existing brainstorming, not generate new ideas:**
   - The brainstorming phase already happened — ideas, perspectives, and tensions are
     documented in the Symphony session
   - Your job: INTERPRET those insights through your persona's lens
   - Identify which brainstorming recommendations align with your persona's priorities
   - Ground every recommendation in specific Symphony insights — cite topics, personas,
     or specific observations
```

**Required output format includes:**

```markdown
## Grounding in Brainstorming

[List 3-5 specific insights from the Symphony session that inform your recommendations.
Reference topics by name (e.g., "Topic 03: Accessibility Concerns noted that...") or cite
specific persona observations. This section demonstrates you've read and evaluated the
brainstorming outputs.]
```

### Why This Works

**Explicit instructions visible to orchestrator:**
- Orchestrator sees exactly what to tell subagents
- File paths are specified (SCOPE.md, OUTLINE.md, BRAINSTORM.md, summaries)
- Context window warnings included (11-17K, 24-34K token counts)
- "EVALUATE existing brainstorming" is emphasized multiple times
- No ambiguity about reading source files

**Quality gate enforced:**
- "Grounding in Brainstorming" section required in output
- Forces subagents to cite specific Symphony insights
- Makes it impossible to skip reading source material

---

## Key Differences: Factory Phase 3 vs. Symphony Phase 2

While the root cause is identical (orchestrator ignoring referenced files), the context differs:

| Aspect | Symphony Phase 2 | Factory Phase 3 |
|--------|------------------|-----------------|
| **Task** | Synthesize persona questions into topic clusters | Draft section recommendations from persona perspectives |
| **Source material** | Persona question files (generated in Phase 2A) | Symphony brainstorming session (external, pre-existing) |
| **Critical failure** | Wrong target counts (15-25 vs 35-50) | Ignoring Symphony source material entirely |
| **Risk** | Insufficient brainstorming questions | Re-generating ideas instead of evaluating existing work |
| **Solution signal** | "Grounding in Brainstorming" not needed (internal) | "Grounding in Brainstorming" section enforced (external source) |

**Factory Phase 3 is higher stakes:**
- Symphony Phase 2 failure = fewer questions than intended (still usable)
- Factory Phase 3 failure = disconnected from Symphony brainstorming (defeats purpose)

---

## SKILL.md Line Count Impact

**Before revision:**
- Total lines: 268
- Phase 3 section: 57 lines (lines 144-200)

**After revision:**
- Total lines: 400 (+132 lines)
- Phase 3 section: 189 lines
- **Still 100 lines under 500-line target**

**Trade-off accepted:**
- Added 132 lines to SKILL.md
- Ensures orchestrator constructs correct prompts
- Critical for Factory's core value proposition (building on Symphony brainstorming)

---

## Step 3B: Section Synthesis Enhancements

Also expanded Step 3B (synthesis) with explicit instructions:

**Added:**
1. **4 numbered steps** for synthesis subagent:
   - Read persona drafts
   - Identify convergence/divergence
   - Synthesize recommendations
   - Maintain traceability

2. **Enhanced output format** with:
   - `personas_consulted:` frontmatter field
   - `convergence_level:` (high/medium/low)
   - "Persona support:" notation for core recommendation
   - "Advocated by:" notation for alternatives
   - "Key Debate Points" section (not just "alternatives")
   - Example debate point showing format

3. **Traceability requirements:**
   - Document which personas supported what
   - Note convergence vs. unique perspectives
   - Preserve reasoning behind disagreements

**Purpose:** Synthesis should make multi-perspective debate visible to end user, not just flatten into consensus.

---

## Pattern Validation

This is the **second time** we've encountered and solved this orchestrator pattern:

### Pattern: Orchestrator Ignores Referenced Files

**Symptom:**
```markdown
**Prompt:** `[skill]/references/prompts/phase-name.md`

For each X:
1. Spawn subagent that [vague instruction]
```

**Result:** Orchestrator creates simplified prompt that misses critical context.

**Solution:**
```markdown
Spawn subagent with following instructions:

**Instructions for subagent:**

1. **Read file X:** `path/to/file.md`
   - What to do with it
2. **Read file Y:** `path/to/file.md`
   - What to do with it
3. **Your task is to [explicit instruction]:**
   - Bullet point details
   - More details
   - Even more details

**Output format:**
[Explicit template with required sections]
```

### When to Embed vs. Reference

**Embed in SKILL.md (orchestrator needs to see):**
- File paths and Read instructions
- Target counts/ranges
- Effort-level conditional logic
- Quality criteria and prioritization rules
- Context window warnings
- Task emphasis (e.g., "EVALUATE not generate")
- Required output sections

**Keep in reference files (subagents read directly):**
- Detailed formatting specifications
- YAML frontmatter templates
- Multi-paragraph guidance
- Examples and edge cases
- Persona-specific prompts

---

## Testing Protocol

### What to Test for Factory Phase 3

**1. Subagent prompt construction:**
- Does orchestrator tell subagents to use Read tool?
- Are file paths specified (SCOPE.md, OUTLINE.md, BRAINSTORM.md, summaries)?
- Is "evaluate existing brainstorming" emphasized?
- Are context window warnings included?

**2. Subagent file reading:**
- Do subagents actually read Symphony session files?
- Do they cite specific topics/personas in "Grounding in Brainstorming" section?
- Do recommendations reference brainstorming insights or generate new ideas?

**3. Quality signals:**
- Draft files include "Grounding in Brainstorming" section
- Recommendations cite Symphony topics by name
- Alternatives reflect tensions from brainstorming (not invented)

### Success Criteria

✅ **Orchestrator constructs prompts with:**
- Explicit Read instructions for Symphony files
- All file paths specified
- "EVALUATE existing brainstorming" language
- Context window warnings (11-17K, 24-34K)

✅ **Subagent drafts demonstrate:**
- Symphony files were read (citations in "Grounding in Brainstorming")
- Recommendations synthesize existing ideas (not generate new ones)
- Persona lens applied to brainstorming insights

✅ **Synthesis files show:**
- Convergence/divergence tracked
- Persona attribution maintained
- Debate points documented (not flattened)

---

## Key Learnings

### 1. Same Root Cause Across Phases

Symphony Phase 2 and Factory Phase 3 failed for the **exact same reason**: orchestrator doesn't read referenced prompt files. This is now a **validated pattern** — any phase with subagent spawning needs explicit instructions in SKILL.md.

### 2. Factory Phase 3 Stakes Are Higher

- Symphony Phase 2 failure: Fewer questions (still usable)
- Factory Phase 3 failure: Disconnected from Symphony (breaks value proposition)

The entire point of Factory is to build on Symphony brainstorming. If subagents don't read Symphony files, Factory becomes a standalone idea generator — defeating its purpose.

### 3. "Grounding" Section as Quality Gate

Requiring a "Grounding in Brainstorming" section forces explicit connection:
- Subagents must cite specific Symphony insights
- Makes source material reading non-optional
- Creates traceability (can verify claims against Symphony files)

### 4. Context Window Warnings Matter

Explicitly stating file sizes (11-17K summaries, 24-34K synthesis) helps:
- Orchestrator understands why selective reading matters
- Subagents budget their context appropriately
- Prevents reading all files unnecessarily

### 5. Line Budget Management

**Concern:** "Embedding will bloat SKILL.md beyond 500 lines"

**Reality:**
- Phase 2: Added 23 lines (404 → 427)
- Phase 3: Added 132 lines (268 → 400)
- Combined: Still manageable (400 lines, 100 under budget)

**Insight:** Only critical parameters and instructions need embedding — detailed formatting and examples stay in reference files.

---

## Recommendations for Other Phases

### Phase 1 (Intake)

**Current state:** Orchestrator-only, no subagents.

**Status:** No changes needed (no subagent spawning).

### Phase 2 (Outline & Personas)

**Current state:** Orchestrator creates outline, generates personas.

**Risk:** If persona generation becomes subagent-driven, apply this pattern.

**Recommendation:** Monitor. If persona quality issues emerge, check if orchestrator is constructing correct prompts.

### Phase 4 (Integration)

**Current state:** Uses external prompt file for integration.

**Risk:** Same pattern — orchestrator may ignore referenced prompt file.

**Recommendation:** If integration quality issues emerge, embed critical instructions (what to read, what to emphasize, output format).

---

## Open Questions

### 1. Can We Make Orchestrator Read Reference Files?

**Current assumption:** Orchestrator doesn't read files referenced as `[skill]/references/prompts/file.md`.

**Question:** Is there a way to make orchestrator read and use these files?

**Hypothesis:** No — orchestrator interprets `[skill]/` as placeholder syntax, not a file path to resolve. Would need different syntax or explicit Read instruction.

**Implication:** Embedding in SKILL.md is the correct long-term pattern.

### 2. How Much Detail is Optimal?

**Current approach:** Embed parameters + instructions, reference files for formatting.

**Trade-off:**
- More detail in SKILL.md = more robust prompts, longer file
- Less detail in SKILL.md = shorter file, risk of misinterpretation

**Current balance:** 400 lines seems reasonable for a complex multi-phase skill with subagent orchestration.

### 3. Should We Pre-emptively Revise Phase 4?

**Question:** Should we embed Phase 4 (Integration) instructions now, or wait for evidence of failure?

**Arguments for waiting:**
- Phase 4 may not exhibit same issue (single subagent, simpler task)
- Premature optimization may add unnecessary complexity

**Arguments for revising now:**
- Pattern is validated across two phases
- Phase 4 already references external prompt file
- Proactive revision prevents future debugging

**Recommendation:** Test Factory Phase 4 first, revise if needed.

---

## Comparison: Before vs. After

### Before (Vague Reference)

```markdown
**Prompt:** `[skill]/references/prompts/phase3-section-draft.md`

For each outline section:
1. Identify assigned personas (from persona files)
2. For each persona, spawn a subagent that:
   - Reads the persona definition
   - Reads SCOPE.md, OUTLINE.md, relevant Symphony summaries
   - Drafts section recommendations from that persona's perspective
```

**Orchestrator interprets as:** "I'll summarize those files for the subagent."

### After (Explicit Instructions)

```markdown
**CRITICAL: Subagents must READ Symphony session files directly. Do NOT summarize
brainstorming insights in the subagent prompt.**

**Instructions for subagent:**

1. **Read your persona definition:** `personas/[persona-slug].md`
2. **Read project context files:**
   - `SCOPE.md`
   - `OUTLINE.md`
3. **Read Symphony brainstorming outputs — THIS IS YOUR SOURCE MATERIAL:**
   - `[symphony-path]/BRAINSTORM.md`
   - `[symphony-path]/synthesis/[NN]_[topic]_summary.md`
   - **Context window warning:** Each summary is 11-17K tokens
4. **Your task is to EVALUATE and SYNTHESIZE existing brainstorming, not generate new ideas**

**Required output format:**
[Explicit template with "Grounding in Brainstorming" section]
```

**Orchestrator interprets as:** "I'll construct a prompt telling the subagent exactly these steps."

---

## Success Metrics

### Goals Achieved

✅ **Explicit Read instructions:** File paths specified, no ambiguity
✅ **Source material emphasis:** "THIS IS YOUR SOURCE MATERIAL" repeated
✅ **Context window warnings:** Token counts provided (11-17K, 24-34K)
✅ **Task clarity:** "EVALUATE not generate" emphasized multiple times
✅ **Quality gate:** "Grounding in Brainstorming" section enforced
✅ **Traceability in synthesis:** Persona attribution maintained
✅ **SKILL.md maintainable:** 400 lines (100 under budget)

### Validation Pending

⏳ **Test Factory Phase 3** with real Symphony session
⏳ **Verify subagents read Symphony files** (check for citations)
⏳ **Verify recommendations synthesize brainstorming** (not new ideas)
⏳ **Verify synthesis tracks convergence/divergence** (persona attribution)

---

## Conclusion

**The orchestrator prompt construction pattern is now validated across two phases** (Symphony Phase 2, Factory Phase 3). The solution — embedding critical instructions directly in SKILL.md — works because:

1. **Orchestrator sees parameters directly** (no file reading required)
2. **Instructions are explicit** (file paths, Read tool usage, task emphasis)
3. **Quality gates are enforced** (required output sections)
4. **Line budget remains manageable** (400/500 lines)

**Key insight:** Orchestrators construct prompts from what they can see in SKILL.md. Reference files are for subagents, not orchestrator navigation.

**Status:** Architecture validated. Ready for Factory Phase 3 testing with real Symphony session.

**Next step:** Run Factory Phase 3 with completed Symphony session and verify:
- Subagents cite Symphony insights in "Grounding in Brainstorming"
- Recommendations synthesize existing brainstorming (not generate new ideas)
- Synthesis tracks persona convergence/divergence
